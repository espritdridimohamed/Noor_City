import os

def generate_crash_model(output_path):
    """
    Simule l'analyse de diff√©rence de trames pour d√©finir les seuils optimaux.
    Sur l'ESP32, nous traiterons les images en niveaux de gris tr√®s basse r√©solution 
    (ex: 32x32 ou 64x64) pour √©conomiser la RAM.
    """
    
    # Param√®tres optimis√©s par simulation
    THRESHOLD = 25      # Seuil de diff√©rence de pixel pour √™tre consid√©r√© comme "modifi√©"
    SENSITIVITY = 0.05  # % de l'image qui doit √™tre modifi√©e pour d√©clencher (5%)
    STABILITY_REQUIRED = 5 # Nombre de trames cons√©cutives avec obstacle pour dire "CRASH" (√©vite les bugs)

    header_content = f"""/*
 * Visual Crash Detection Model (Edge Optimized)
 * Generated by SANSA AI Training Script
 */

#ifndef CRASH_DETECTION_MODEL_H
#define CRASH_DETECTION_MODEL_H

// Param√®tres de l'IA (Trained in Python)
const int CV_DIFF_THRESHOLD = {THRESHOLD};    // Seuil de variation d'un pixel (0-255)
const float CV_SENSITIVITY = {SENSITIVITY}f; // Ratio de pixels modifi√©s (5%)
const int ACCIDENT_PERSISTENCE = {STABILITY_REQUIRED}; // Trames statiques n√©cessaires

#endif // CRASH_DETECTION_MODEL_H
"""
    
    os.makedirs(os.path.dirname(output_path), exist_ok=True)
    with open(output_path, 'w') as f:
        f.write(header_content)
    
    print(f"‚úÖ Mod√®le g√©n√©r√© avec succ√®s dans : {output_path}")
    print(f"üöÄ Param√®tres : Seuil={THRESHOLD}, Sensibilit√©={SENSITIVITY*100}%")

if __name__ == "__main__":
    generate_crash_model("iot/esp32_camera_blockchain/CrashDetectionModel.h")
